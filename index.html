<!DOCTYPE html>
<html lang='en'>
<head>
	<meta charset='utf-8' />

	<title>Hiking trail stuff</title>

	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
	<script src="http://maps.google.com/maps/api/js?sensor=false"></script>

	<script src="code.js"></script>

	<link href="style.css" rel="stylesheet" type="text/css">

	<style type="text/css">
		body { margin:0; }
		#map_canvas { width: 100%; height: 400px; }
	</style>
</head>
<body>
	<div id="map_canvas"></div>

	<script type="text/javascript">
		/**
		 * Create the map
		 */
  
		var rendererOptions = {
			draggable: true
		};
		var directionsService = new google.maps.DirectionsService();
		var directionsDisplay = new google.maps.DirectionsRenderer(rendererOptions);
		
		var mapCenter = new google.maps.LatLng(46.042795,6.418376);
		var mapOptions = {
		  zoom:14,
		  mapTypeId: google.maps.MapTypeId.TERRAIN,
		  center: mapCenter
		}
		var map = new google.maps.Map(document.getElementById("map_canvas"), mapOptions);
		directionsDisplay.setMap(map);



		/**
		 * Create the menu and attached it to the map
		 */
		var menu = new contextMenu({map:map});


		
		

		var from, to, marker;
		function calcRoute2() {
			var request;
			
			if(!to) {
				marker = new google.maps.Marker({
					  position: from,
					  map: map
				  });
				  console.log(marker);
				  console.log(map);
			} else {
				request = {
					origin: from,
					destination: to,
					travelMode: google.maps.TravelMode['WALKING']
				};	
				directionsService.route(request, function(response, status) {
					if (status == google.maps.DirectionsStatus.OK) {
						directionsDisplay.setDirections(response);
					}
				});
				marker.setMap(null);
			}
			
		}
		
		menu.addItem('Directions from here', function(map, latLng){
			from = latLng;
			menu.remove('from');
			calcRoute2();
		});

		menu.addItem('Directions to here', function(map, latLng){
			to = latLng;
			calcRoute2();
		});







		//http://code.google.com/apis/maps/documentation/javascript/overlays.html#MarkerAnimations

		//from :46.03540697369472, 6.4238691640624666
		//middle : 46.039873085624265, 6.419105100524803
		//to : 46.04285457684193, 6.417861015869107

		menu.addSep();
		menu.addItem('Show me the way', function(map, latLng){
			console.log(latLng);
			calcRoute();
		});

		var start = new google.maps.LatLng(46.03540697369472, 6.4238691640624666);
		var end = new google.maps.LatLng(46.04285457684193, 6.417861015869107);
		function calcRoute() {
			var request = {
				origin: start,
				destination: end,
				waypoints: [
				{
					location:new google.maps.LatLng(46.039873085624265, 6.419105100524803),
					stopover:false
				}
				],
				// Note that Javascript allows us to access the constant
				// using square brackets and a string value as its
				// "property."
				travelMode: google.maps.TravelMode['WALKING']
			};
			directionsService.route(request, function(response, status) {
				if (status == google.maps.DirectionsStatus.OK) {
					directionsDisplay.setDirections(response);
				}
			});
		}










		menu.addSep();

		// Add some items to the menu
		menu.addItem('Zoom In', function(map, latLng){
			map.setZoom( map.getZoom() + 1);
			map.panTo( latLng );
		});

		menu.addItem('Zoom Out', function(map, latLng){
			map.setZoom( map.getZoom() - 1 );
			map.panTo(latLng);
		});

		menu.addSep();

		menu.addItem('Center Here', function(map, latLng){
			map.panTo(latLng);
		});
		
		
	</script>

</body>
</html>
